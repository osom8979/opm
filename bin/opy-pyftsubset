#!/usr/bin/env bash

if ! command -v opm-version &> /dev/null; then
PATH="$(cd "$(dirname "${BASH_SOURCE[0]}")" || exit; pwd):$PATH"
fi

function install_package_if_not_exist
{
    opy3-pip show "$1" &> /dev/null
    local code=$?
    if [[ $code -eq 0 ]]; then
        return 0
    fi
    opy3-pip install -U "$1"
}

function exit_on_error
{
    local code=$?
    if [[ $code -ne 0 ]]; then
        exit $code
    fi
}

function opy_pyftsubset_main
{
    install_package_if_not_exist fonttools
    exit_on_error

    install_package_if_not_exist zopfli
    exit_on_error

    install_package_if_not_exist brotli
    exit_on_error

    opy3 -m fontTools.subset "$@"
}

opy_pyftsubset_main "$@"
