#!/bin/bash

GCC_CMD=g++
GCC_FLAGS="-std=c++11 -E -v -x c++"
GCC_PREPROCESSOR_VERBOSE=`$GCC_CMD $GCC_FLAGS - < /dev/null 2>&1`

START_REGEXP='#include.*search starts.*'
END_REGEXP='End of search list.*'

INCLUDE_START=`echo -e "$GCC_PREPROCESSOR_VERBOSE" | egrep -n "$START_REGEXP" | head -1`
INCLUDE_START_LINE=`echo -e "$INCLUDE_START" | awk -F':' '{printf($1);}'`

INCLUDE_END=`echo -e "$GCC_PREPROCESSOR_VERBOSE" | egrep -n "$END_REGEXP" | head -1`
INCLUDE_END_LINE=`echo -e "$INCLUDE_END" | awk -F':' '{printf($1);}'`

## Extract cpath.
INCLUDE_BODY=`echo -e "$GCC_PREPROCESSOR_VERBOSE" | sed -n "${INCLUDE_START_LINE},${INCLUDE_END_LINE}p"`
INCLUDE_LIST=`echo -e "$INCLUDE_BODY" | egrep -v "$START_REGEXP|$END_REGEXP"`

PLATFORM=`platform`
if [[ $PLATFORM == 'MacOSX' ]]; then
    INCLUDE_LIST=`echo -e "$INCLUDE_LIST" | sed -e 's/(framework directory)//g'`
fi

## Trim string.
INCLUDE_LIST=`echo -e "$INCLUDE_LIST" | sed -e 's/ *//g'`

## Remove current directory.
INCLUDE_LIST=`echo -e "$INCLUDE_LIST" | grep -v '^\.$'`

echo -e "$INCLUDE_LIST"
